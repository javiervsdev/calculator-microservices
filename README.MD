<h1 align="center">üßÆ calculator-microservices</h1>

<h2 id="table-of-contents"> üìñ √çndice</h2>

<ol>
    <li><a href="#introduccion"> ‚û§ Introducci√≥n</a></li>
    <li><a href="#requisitos-tecnicos"> ‚û§ Requisitos t√©cnicos</a></li>
    <li><a href="#tecnologias"> ‚û§ Tecnolog√≠as</a></li>
    <li><a href="#estructura-proyecto"> ‚û§ Estructura del proyecto</a></li>
    <ol>
        <li><a href="#proyecto-padre"> ‚û§ Proyecto padre</a></li>
        <li><a href="#addition-subtraction"> ‚û§ addition y subtraction</a></li>
        <li><a href="#common"> ‚û§ common</a></li>
    </ol>
    <li><a href="#funcionalidad"> ‚û§ Funcionalidades implementadas</a></li>
    <li><a href="#compilacion-ejecucion"> ‚û§ Compilaci√≥n y ejecuci√≥n</a></li>
    <li><a href="#ejemplos-llamadas"> ‚û§ Ejemplos de llamadas</a></li>
</ol>

<h2> üìù Introducci√≥n</h2>

API REST para realizar operaciones aritm√©ticas a partir de unos par√°metros de entrada.

Esta versi√≥n solo es capaz de realizar operaciones de suma y resta ya que es una prueba de concepto.

<h2> üìè Requisitos t√©cnicos</h2>

<ul>
    <li>Hacer uso de control de versiones en Git.</li>
    <li>Uso de Maven como manejador de dependencias.</li>
    <li>Incluir la dependencia del jar mediante el plugin maven-install-plugin.</li>
    <li>Deber√° ser una aplicaci√≥n Spring Boot.</li>
    <li>Uso de JUnit5 para la realizaci√≥n de Pruebas Unitarias.</li>
    <li>Manejar una versi√≥n actual de JAVA para su desarrollo (m√≠nimo JDK11).</li>
    <li>Construcci√≥n de la API RESTful con el est√°ndar de OpenAPI.</li>
    <li>Aplicar los principios SOLID.</li>
    <li>Plantear un manejo de excepciones (operaciones invalidas).</li>
    <li>Deber√° compilar sin errores en una instalaci√≥n de Maven Limpia.</li>
    <li>Uso de operandos de tipo BigDecimal.</li>
</ul>

<h2 id="tecnologias"> üíª Tecnolog√≠as</h2>

<ul>
    <li>Java 18</li>
    <li>Spring Boot 2.7.2</li>
    <li>Swagger</li>
    <li>JUnit 5</li>
    <li>Mockito 4.5.1</li>
    <li>Jackson 2.13.3</li>
</ul>

<h2 id="estructura-proyecto"> üìÅ Estructura del proyecto</h2>

Consta de un proyecto padre y tres m√≥dulos hijos (addition, subtraction y common).
<ol>
<li>
<h3 id="proyecto-padre">Proyecto padre</h3>

Contiene a los m√≥dulos hijos as√≠ como el pom principal del que depender√°n todos los m√≥dulos.

En √©l se definen las dependencias que usar√°n los m√≥dulos hijos seg√∫n las necesidades de cada uno.

Tambi√©n contiene un <strong>fichero json para importar en postman</strong> y poder realizar las llamadas a la api.

<h4>Dependencias:</h4>
<ul>
    <li>
        <p><strong>spring-boot-dependencies:</strong> se a√±ade como dependencyManagement para que, tanto el proyecto padre 
        como los m√≥dulos hijos puedan usar las dependencias que necesiten de Spring Boot 2.7.2</p>
    </li>
    <li>
        <p><strong>lombok:</strong> utilizada para generar c√≥digo boilerplate en los m√≥dulos hijos y as√≠ generar un c√≥digo 
        m√°s limpio.</p>
    </li>
    <li>
        <p><strong>spring-boot-starter-web:</strong> proporciona todas las dependencias necesarias para ejecutar una 
        aplicaci√≥n web.</p>
    </li>
    <li>
        <p><strong>spring-boot-starter-test:</strong> proporciona todas las dependencias necesarias para realizar las
        pruebas de la aplicaci√≥n.</p>
    </li>
</ul>
</li>
<li>
<h3 id="addition-subtraction">addition y subtraction</h3>

Son los m√≥dulos hijos que contienen las operaciones de suma y resta respectivamente. Son m√≥dulos independientes entre
s√≠, pero su estructura es la misma.

<h4>En estos m√≥dulos se organizan las clases java en los paquetes controller, service y dto:</h4>

<ul>
    <li>
        <p><strong>controller:</strong> contiene los componentes encargados de recibir las peticiones a la api.</p>
            <ul>
                <li>
                    <p><strong>AdditionController/SubtractionController:</strong> carecen de l√≥gica de negocio y su 
                    funci√≥n es enviar los datos recibidos a la capa de servicio para que los procese y devuelva el 
                    resultado.</p>
                </li>
            </ul>
    </li>
    <li>
        <p><strong>service:</strong> contiene los componentes encargados de realizar la l√≥gica de negocio.</p>
            <ul>
                <li>
                    <p><strong>AdditionService/SubtractionService:</strong> interfaces de los servicios que se encargan 
                    de definir un contrato que las implementaciones deber√°n de cumplir.</p>
                    <p>Esta interfaz es la que se inyecta en el controlador correspondiente aplicando as√≠ el principio
                    de inversi√≥n de dependencias correspondiente a la D de SOLID.</p>
                </li>
                <li>
                    <p><strong>AdditionServiceImpl/SubtractionServiceImpl:</strong> implementaciones de las interfaces
                    anteriores que contiene la l√≥gica de negocio. Genera la operaci√≥n aritm√©tica correspondiente, 
                    tracea el resultado y lo retorna.</p>
                </li>
            </ul>
    </li>
    <li>
        <p><strong>dto:</strong> contiene los objetos con los datos del proceso</p>
            <ul>
                <li>
                    <p><strong>AdditionRequest/SubtractionRequest:</strong> contienen los datos que se reciben de la
                    petici√≥n</p>
                </li>
                <li>
                    <p><strong>Addition/Subtraction:</strong> representan las operaciones de suma y resta.</p>
                    <p>El constructor de estas clases es privado para evitar la creaci√≥n de objetos con un estado err√≥neo.
                    En su lugar se proporciona un m√©todo est√°tico que valida que los datos sean correctos, y si es as√≠,
                    construye el objeto el cual retornar√°. En caso contrario lanza una excepci√≥n personalizada. Con esto
                    se consigue crear un <strong>constructor sem√°ntico</strong> o <strong>named constructor</strong></p>
                    <p>Por otra parte, estas clases tienen la peculiaridad de no implementar getters ni setters. Esto
                    se realiza as√≠ para aplicar el principio 
                    <a href="https://martinfowler.com/bliki/TellDontAsk.html">Tell-Don't-Ask</a> pidi√©ndole as√≠ al 
                    objeto Addition/Subtraction que nos d√© el resultado en lugar de pedir los operandos y realizar 
                    la operaci√≥n. Con esto se consigue llevar la l√≥gica hacia el punto m√°s cohesionado favoreciendo
                    la S de SOLID</p>
                </li>
            </ul>
    </li>
</ul>

<h4>Los test de estos m√≥dulos se encuentran en las clases:</h4>

<ul>
    <li>
        <strong>AdditionControllerTest/SubtractionControllerTest:</strong> contiene las pruebas de los controladores 
        verificando que el tipo de resultado de la petici√≥n y el estado sea el correcto, tanto si la operaci√≥n es 
        correcta como si se produce una excepci√≥n de validaci√≥n de datos de entrada. Con estos test se comprueba el 
        correcto funcionamiento de los controladores y del handlerException.
    </li>
    <li>
        <strong>AdditionServiceTest/SubtractionServiceTest</strong> contiene los test de los servicios que prueban
        que la ejecuci√≥n de las operaciones(suma/resta) es correcta o en caso de recibir par√°metros de entrada 
        incorrectos lanzar una excepci√≥n. Con estos test se comprueba el correcto funcionamiento de los servicios y 
        l√≥gica de las clases Addition/Subtraction.
    </li>
</ul>

<h4>Las dependencias especificadas en estos proyectos son: (no se mencionan las dependencias heredadas porque ya se
han explicado anteriormente)</h4>

<ul>
    <li>
        <strong>common:</strong> se a√±ade como dependencia el m√≥dulo common para que puedan hacer uso de las clases comunes.
    </li>
    <li>
        <strong>springdoc-openapi-ui:</strong> permite documentar la API REST y proporciona una interfaz de usuario para 
        visualizar la documentaci√≥n.
    </li>
</ul>

<h4>Adem√°s, ha sido necesario especificar los siguientes plugins en los poms:</h4>

<ul>
    <li><p><strong>maven-surefire-plugin</strong> y <strong>maven-failsafe-plugin:</strong> Se han a√±adido estos
    plugins debido a bug de maven que provocaba que al hacer uso de comandos como mvn test no ejecutase los tests.
    Al a√±adir estos plugins con la versi√≥n 2.2.0 ya se reconocen y ejecutan. Para informaci√≥n m√°s detallada acceder
    <a href="https://dzone.com/articles/why-your-junit-5-tests-are-not-running-under-maven">aqu√≠</a></p></li>
</ul>
</li>
<li>
<h3 id="common">common</h3>

M√≥dulo que contiene las clases comunes que se utilizan en los m√≥dulos de Addition/Subtraction.

<h4>Las clases java comunes se organizan en los paquetes advice, configuration, dto y exception:</h4>

<ul>
    <li>
        <p><strong>advice:</strong> contiene la clase <strong>ExceptionAdvice</strong> donde se controla la excepci√≥n
        personalizada OperandException</p>
    </li>
    <li>
        <p><strong>configuration:</strong> contiene la clase <strong>TracerConfiguration</strong> en la cual se genera 
        un bean con el tracer importado del jar indicado en el enunciado de la prueba</p>
    </li>
    <li>
        <p><strong>dto:</strong></p>
        <ul>
            <li>
                <p><strong>ApiError:</strong> clase usada como respuesta al controlar la excepci√≥n OperandException.</p>
            </li>
            <li>
                <p><strong>ResultResponse:</strong> clase usada como respuesta correcta de las operaciones de suma 
                y resta. Contiene el resultado de la operaci√≥n</p>
            </li>
            <li>
                <p><strong>ArithmeticOperation:</strong> interfaz que implementan las clases de Addition/Subtraction.
                Esta interfaz est√° enfocada en generar el comportamiento de una operaci√≥n aritm√©tica obligando a 
                implementar un m√©todo que devuelva el resultado de la operaci√≥n correspondiente. Al utilizar una 
                interfaz para modelar el comportamiento se aplica el principio 
                <a href="https://en.wikipedia.org/wiki/Composition_over_inheritance">Composici√≥n sobre herencia</a></p>
            </li>
        </ul>
    </li>
    <li>
        <p><strong>exception:</strong> contiene la excepci√≥n personalizada OperandException que se utiliza para indicar 
        que alguno de los operandos recibidos es incorrecto</p>
    </li>
</ul>
<h4>Pom:</h4>

En este caso solo hay una √∫nica dependencia en el m√≥dulo, siendo esta la dependencia del jar tracer proporcionado.
Para que esta dependencia del jar se pueda utilizar en el proyecto, se configura en el pom el plugin
<strong>maven-install-plugin</strong> indic√°ndole la ruta del jar dentro del proyecto. Esta ruta se encuentra en common
en "src/main/resources/dependencies/tracer-1.0.0.jar"
</li>
</ol>

<h2 id="funcionalidad">‚ú® Funcionalidades implementadas</h2>

Para esta prueba de concepto se han implementado las funcionalidades acordes a las operaciones aritm√©ticas de suma y
resta.

Cada una de estas operaciones se han implementado en m√≥dulos distintos para permitir que el proyecto a medida que vaya
creciendo con m√°s operaciones aritm√©ticas sea f√°cil de mantener y escalar.

La funcionalidad de suma se encuentra en el m√≥dulo <strong>addition</strong> y la funcionalidad de resta en el m√≥dulo
<strong>subtraction</strong>. Ambas funcionalidades necesitan recibir como par√°metros de entrada dos n√∫meros
correspondientes a los operandos que se utilizar√°n para realizar la operaci√≥n invocada. Tras la ejecuci√≥n correcta de
la funcionalidad se devolver√° una respuesta 200 con un objeto json que contiene el resultado de la operaci√≥n.
Estos par√°metros de entrada son obligatorios, puesto que la ausencia de alguno de ellos o ambos generar√° un
error 400 - Bad Request.

<h2 id="compilacion-ejecucion">‚ñ∂ Compilaci√≥n y ejecuci√≥n</h2>

Primero es necesario instalar la librer√≠a tracer proporcionada. Para ello se debe ejecutar el siguiente comando:
```
mvn clean validate
```

Para llevar a cabo la compilaci√≥n del proyecto es necesario posicionarse en el proyecto padre y ejecutar el siguiente
comando:
```
mvn clean install
```
Con esto se compila el proyecto, se pasan los test y se generan los ficheros .jar necesarios para ejecutarlo.

Una vez realizado este paso ser√° necesario realizar un <strong>cd</strong> a los directorios de los m√≥dulos de addition
y subtraction y ejecutar en cada uno de ellos el siguiente comando:
```
mvn spring-boot:run
```

Otra opci√≥n ser√≠a  ejecutar los dos siguientes comandos estando posicionado desde el directorio del proyecto padre:
```
mvn -pl addition spring-boot:run

mvn -pl sustraction spring-boot:run
```
Esto lanzar√° la aplicaci√≥n en el puerto correspondiente siendo para addition el puerto 8080 y para subtraction el
puerto 8081.

Si se quieren lanzar solo los tests, se ejecuta el siguiente comando:
```
mvn test
```

<h2 id="ejemplos-llamadas">üìû Ejemplos de llamadas</h2>

Al levantar los m√≥dulos de addition y subtraction se podr√°n realizar peticiones a dos endpoints distintos.
En ambos m√≥dulos se puede acceder a m√°s detalles de las operaciones, ya que est√° configurado swagger.
En la siguiente url se podr√°n ver los detalles del API en formato JSON:
```
http://localhost:{puerto}/api-docs
```

Para acceder a la documentaci√≥n con interfaz de usuario, donde tambi√©n se podr√°n realizar peticiones para probar
los endpoints, acceder a la siguiente url:
```
http://localhost:{puerto}/swagger-ui/index.html
```

<strong>NOTA:</strong> ser√° necesario modificar en las urls la variable {puerto} por el valor 8080 en el caso de querer
probar el m√≥dulo addition u 8081 en el caso de querer probar el m√≥dulo subtraction.

Adem√°s, se proporciona un fichero json llamado <strong>calculator-microservices.postman_collection.json</strong> que
contiene una colecci√≥n de peticiones que se pueden importar en Postman para probar los endpoints de los m√≥dulos. Este
fichero se encuentra en el proyecto padre.

<h3>- addition</h3>

La llamada al endpoint addition es la siguiente:
```
http://localhost:8080/api/addition?firstOperand=2&secondOperand=3
```

La respuesta a esta llamada ser√° un 200 devolviendo el valor resultante de la suma:
```
{
  "result": 5
}
```

Un ejemplo de llamada err√≥nea ser√≠a eliminando cualquiera de los dos par√°metros o ambos:
```
http://localhost:8080/api/addition?firstOperand=2
```

Al realizar esta llamada u otra en la que no se informen todos los par√°metros el servidor devolver√° un error 400 con el
siguiente cuerpo:
```
{
  "code": 400,
  "message": "Operands cannot be null"
}
```

<h3>- subtraction</h3>

La llamada al endpoint subtraction es la siguiente:
```
http://localhost:8081/api/subtraction?firstOperand=5&secondOperand=2
```

La respuesta a esta llamada ser√° un 200 devolviendo el valor resultante de la resta:
```
{
  "result": 3
}
```

Un ejemplo de llamada err√≥nea ser√≠a eliminando cualquiera de los dos par√°metros o ambos:
```
http://localhost:8080/api/subtraction?firstOperand=2
```

Al realizar esta llamada u otra en la que no se informen todos los par√°metros, el servidor devolver√° un error 400 con el
siguiente cuerpo:
```
{
  "code": 400,
  "message": "Operands cannot be null"
}
```